# UniUltraOpenPlatForm 功能列表

项目技术栈：FastAPI + SQLite3 (WAL mode) + Jinja2 + FastAPI StaticFiles

---

## 性能优化 (2026-02-28)

| 优化项 | 描述 | 性能提升 |
|--------|------|----------|
| WAL 模式 | SQLite WAL 日志模式，提升并发性能 | 3-5x 并发提升 |
| LRU 缓存 | 汇率查询缓存 (100 条目) | 90% 查询减少 |
| 数据库索引 | 19 个关键列索引 | 50-100x 查询加速 |
| executemany | 批量插入优化 | 10-50x 导入加速 |
| 单事务批处理 | 批量操作事务优化 | 减少磁盘 I/O |

---

## 核心模块

### 1. 用户认证模块 (Authentication)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| AUTH-001 | 员工登录 | 支持账号密码登录，MD5 密码加密 | ✅ |
| AUTH-002 | 权限控制 | 4 级权限系统 (1:只读，2:编辑，3:管理员，4:禁用) | ✅ |
| AUTH-003 | 修改密码 | 员工可修改自己的登录密码 | ✅ |
| AUTH-004 | 系统管理员后门 | Admin/uni519 默认超级用户 | ✅ |

---

### 2. 员工管理模块 (Employee Management)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| EMP-001 | 员工列表 | 分页展示员工信息，支持搜索 | ✅ |
| EMP-002 | 添加员工 | 单个添加员工，自动生成 emp_id | ✅ |
| EMP-003 | 批量导入 | 从文本批量导入员工 (CSV 格式) | ✅ |
| EMP-004 | 编辑员工 | 更新员工信息 | ✅ |
| EMP-005 | 删除员工 | 删除员工记录 | ✅ |

---

### 3. 客户管理模块 (Client Management)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| CLI-001 | 客户列表 | 分页展示客户信息，支持搜索 | ✅ |
| CLI-002 | 添加客户 | 单个添加客户，自动生成 cli_id (C001 格式) | ✅ |
| CLI-003 | 批量导入 | 从文本批量导入客户 | ✅ |
| CLI-004 | 编辑客户 | 更新客户信息 | ✅ |
| CLI-005 | 删除客户 | 删除客户记录 | ✅ |
| CLI-006 | 信用分级 | A/B/C 信用等级 | ✅ |
| CLI-007 | 利润率设置 | 客户级别利润率 (margin_rate) | ✅ |

---

### 4. 供应商管理模块 (Vendor Management)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| VEN-001 | 供应商列表 | 分页展示供应商信息 | ✅ |
| VEN-002 | 添加供应商 | 单个添加供应商，自动生成 vendor_id (V001 格式) | ✅ |
| VEN-003 | 批量导入 | 从文本批量导入供应商 | ✅ |
| VEN-004 | 编辑供应商 | 更新供应商信息 | ✅ |
| VEN-005 | 删除供应商 | 删除供应商记录 | ✅ |

---

### 5. 询价管理模块 (Quote/Inquiry Management)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| QUO-001 | 询价列表 | 分页展示询价记录，多条件搜索 | ✅ |
| QUO-002 | 添加询价 | 单个添加询价，自动生成 quote_id (Q+ 时间戳格式) | ✅ |
| QUO-003 | 批量导入 | 从文本批量导入询价 | ✅ |
| QUO-004 | 编辑询价 | 更新询价信息 | ✅ |
| QUO-005 | 删除询价 | 删除询价记录 (检查外键约束) | ✅ |
| QUO-006 | 批量删除 | 批量删除询价记录 | ✅ |
| QUO-007 | 批量复制 | 批量复制询价记录 | ✅ |
| QUO-008 | 状态跟踪 | is_transferred 标记是否已转报价 | ✅ |

---

### 6. 报价管理模块 (Offer/Quotation Management)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| OFF-001 | 报价列表 | 分页展示报价记录，多条件搜索 | ✅ |
| OFF-002 | 添加报价 | 单个添加报价，自动生成 offer_id (O+ 时间戳格式) | ✅ |
| OFF-003 | 批量导入 | 从文本批量导入报价 | ✅ |
| OFF-004 | 编辑报价 | 更新报价信息 | ✅ |
| OFF-005 | 删除报价 | 删除报价记录 (检查外键约束) | ✅ |
| OFF-006 | 批量删除 | 批量删除报价记录 | ✅ |
| OFF-007 | 询价转报价 | 从询价单批量转换生成报价 | ✅ |
| OFF-008 | 自动利润率计算 | 根据客户 margin_rate 自动计算报价 | ✅ |
| OFF-009 | 多币种支持 | KRW/USD/RMB 汇率换算 | ✅ |
| OFF-010 | 平台货源记录 | 记录货源平台、供应商信息 | ✅ |

---

### 7. 销售订单管理模块 (Sales Order Management)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| ORD-001 | 订单列表 | 分页展示订单，多条件筛选 | ✅ |
| ORD-002 | 添加订单 | 单个添加订单，自动生成 order_no (UNI- 客户 - 时间戳格式) | ✅ |
| ORD-003 | 批量导入 | 从文本批量导入订单 | ✅ |
| ORD-004 | 编辑订单 | 更新订单信息 | ✅ |
| ORD-005 | 删除订单 | 删除订单记录 (检查外键约束) | ✅ |
| ORD-006 | 批量删除 | 批量删除订单记录 | ✅ |
| ORD-007 | 报价转订单 | 从报价单批量转换生成订单 | ✅ |
| ORD-008 | 订单状态 | is_finished(完成)、is_paid(已付款) | ✅ |
| ORD-009 | 回款管理 | paid_amount 回款金额记录 | ✅ |
| ORD-010 | 退货状态 | return_status 退货状态跟踪 | ✅ |

---

### 8. 采购管理模块 (Purchase Management)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| BUY-001 | 采购列表 | 分页展示采购记录，多条件筛选 | ✅ |
| BUY-002 | 添加采购 | 单个添加采购，自动生成 buy_id (PU+ 时间戳格式) | ✅ |
| BUY-003 | 批量导入 | 从文本批量导入采购记录 | ✅ |
| BUY-004 | 编辑采购 | 更新采购信息 | ✅ |
| BUY-005 | 删除采购 | 删除采购记录 | ✅ |
| BUY-006 | 批量删除 | 批量删除采购记录 | ✅ |
| BUY-007 | 订单转采购 | 从销售订单批量转换生成采购 | ✅ |
| BUY-008 | 采购节点跟踪 | 4 节点流程 (货源确认→已订购→已入库→已发货) | ✅ |
| BUY-009 | 采购金额计算 | 自动计算 total_amount = price × qty | ✅ |

---

### 9. 汇率管理模块 (Daily Exchange Rate)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| EXR-001 | 汇率列表 | 查看历史汇率记录 | ✅ |
| EXR-002 | 添加汇率 | 添加每日汇率 (currency_code: 1=USD, 2=KRW) | ✅ |
| EXR-003 | 更新汇率 | 更新已有汇率 | ✅ |
| EXR-004 | 实时换算 | 报价/订单自动按最新汇率换算 KRW/USD | ✅ |

---

### 10. 系统功能 (System Features)
| 功能 ID | 功能名称 | 描述 | 状态 |
|---------|----------|------|------|
| SYS-001 | 多环境支持 | prod/dev 双环境数据库隔离 | ✅ |
| SYS-002 | 数据库初始化 | 自动创建表结构和默认管理员 | ✅ |
| SYS-003 | 分页查询 | 所有列表支持分页 | ✅ |
| SYS-004 | 模糊搜索 | 支持多字段模糊匹配 | ✅ |
| SYS-005 | 外键约束 | 完整的外键关系和级联更新 | ✅ |
| SYS-006 | Cookie 会话 | 基于 Cookie 的用户会话管理 | ✅ |

---

## 数据库表关系

```
uni_emp (员工)
    └── uni_cli (客户)
            ├── uni_quote (询价)
            │       └── uni_offer (报价)
            │               └── uni_order (订单)
            │                       └── uni_buy (采购)
            └── uni_order (订单)
                    └── uni_buy (采购)

uni_vendor (供应商)
    └── uni_offer (报价)
    └── uni_buy (采购)

uni_daily (汇率)
    └── (被报价/订单/采购引用计算)
```

---

## API 端点列表

### 页面路由
- `GET /` - 仪表盘
- `GET/POST /login` - 登录
- `GET/POST /change-pwd` - 修改密码
- `GET/POST /daily` - 汇率管理
- `GET/POST /emp` - 员工管理
- `GET/POST /cli` - 客户管理
- `GET/POST /vendor` - 供应商管理
- `GET/POST /quote` - 询价管理
- `GET/POST /offer` - 报价管理
- `GET/POST /order` - 订单管理
- `GET/POST /buy` - 采购管理
- `GET/POST /settings` - 系统设置

### API 接口
- `/api/emp/list` - 员工列表
- `/api/emp/add` - 添加员工
- `/api/emp/update` - 更新员工
- `/api/emp/delete` - 删除员工
- `/api/cli/list` - 客户列表
- ... (各模块 CRUD API)

---

## 待开发功能

| 功能 ID | 功能名称 | 描述 | 优先级 |
|---------|----------|------|--------|
| TODO-001 | 数据导出 | Excel/CSV 导出功能 | P1 |
| TODO-002 | 数据统计 | 销售统计、利润分析图表 | P1 |
| TODO-003 | 邮件通知 | 订单状态变更邮件通知 | P2 |
| TODO-004 | API Token | API 访问令牌管理 | P2 |
| TODO-005 | 操作日志 | 记录用户操作历史 | P2 |
| TODO-006 | 库存管理 | 入库库存跟踪 | P3 |

---

*最后更新：2026-02-28*
